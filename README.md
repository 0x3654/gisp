# **–ì–ò–°–ü —Ä–µ–µ—Å—Ç—Ä, API –∏ –ß–∞—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞**

–ü–æ–∏—Å–∫ –ø–æ —Ä–µ–µ—Å—Ç—Ä—É —Ä–æ—Å—Å–∏–π—Å–∫–æ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –ú–∏–Ω–ø—Ä–æ–º—Ç–æ—Ä–≥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —á–∞—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å api.

`PostgreSQL` —Å –≥–æ—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, `FastAPI‚Äë—à–ª—é–∑`, `—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å` –∏ —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –±–∞–∑–µ `OpenWebUI`.

`import` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç —Å–≤–µ–∂–∏–µ CSV —Ñ–∞–π–ª—ã –∫–∞–∂–¥—É—é –Ω–æ—á—å, –ø–∏—à–µ—Ç –ª–æ–≥–∏, —á–∏—Å—Ç–∏—Ç —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã.

–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–æ–∏—Å–∫ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏: —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–∞—Ç –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –æ–±–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –µ–¥–∏–Ω–æ–º —Å–ø–∏—Å–∫–µ. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –æ–ø–∏—Å–∞–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ [–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —á–∞—Ç–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤-–≤-—á–∞—Ç–µ).

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="docs/chat-dark.png">
  <source media="(prefers-color-scheme: light)" srcset="docs/chat-light.png">
  <img alt="–°–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–∏—Å–∫–∞ –≤ —á–∞—Ç–µ" src="docs/chat-light.png">
</picture>

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- Docker Engine + Docker Compose Plugin (–≤–µ—Ä—Å–∏—è 2.20+) –∏ Git, Ubuntu 20/Debian 12 –∏ –Ω–æ–≤–µ–µ:
  ```bash
  sudo apt update
  sudo apt install -y docker.io docker-compose-plugin git
  sudo usermod -aG docker "$USER"
  ```
- 6‚ÄØ–ì–ë RAM (8‚ÄØ–ì–ë —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –∏ ~6-10‚ÄØ–ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–∏—Å–∫–∞ (–æ–±—Ä–∞–∑—ã ‚âà 3‚ÄØ–ì–ë, –º–æ–¥–µ–ª—å ‚âà 1‚ÄØ–ì–ë; —Å—Ç–∞—Ä—Ç–æ–≤—ã–π snapshot –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.

# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–í—ã–ø–æ–ª–Ω–∏—Ç–µ bootstrap-—Å–∫—Ä–∏–ø—Ç (—Å–∫–∞—á–∏–≤–∞–µ—Ç ~3‚ÄØ–ì–ë –æ–±—Ä–∞–∑–æ–≤ –∏ ~1‚ÄØ–ì–ë –¥–∞–Ω–Ω—ã—Ö, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ):

```bash
curl -fsSL https://raw.githubusercontent.com/0x3654/gisp/master/scripts/bootstrap.sh | bash
```

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç Docker/Compose/Git, –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥–∏, –∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –¥–∞–º–ø —á–µ—Ä–µ–∑ `starter-dump` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `postgres_registry`, `api`, `import`, `semantic`, `openwebui`. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3333 admin@gisp.ru 123

# **–£—Å—Ç–∞–Ω–æ–≤–∫–∞**

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/0x3654/gisp.git
   cd gisp
   ```
2. –°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤:
   ```bash
   cp .env.example .env
   cp services/semantic/synonyms.example.json services/semantic/synonyms.json
   ```
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
   - `REGISTRY_NODE_NAME` ‚Äî –ø–æ–¥–ø–∏—Å—å —Å–µ—Ä–≤–µ—Ä–∞ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞—Ç—å, –±—É–¥–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).
   - `BOT_TOKEN`/`CHAT_ID` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Telegram.
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å:
     - `POSTGRES_*` ‚Äî –∫—Ä–µ–¥—ã PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è API, –∏–º–ø–æ—Ä—Ç–µ—Ä–æ–º –∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏).
     - `FILES_DIR`, `LOG_DIR`, `MAX_*` ‚Äî –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –æ—á–∏—Å—Ç–∫–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `import`.
     - `SEMANTIC_CACHE_TTL_SECONDS` ‚Äî —Å–∫–æ–ª—å–∫–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 —Å—É—Ç–æ–∫ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö).

4. *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)* –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `services/semantic/synonyms.json`, –¥–æ–±–∞–≤–∏–≤ —Å–≤–æ–∏ –ø–∞—Ä—ã ¬´—Ç–µ—Ä–º–∏–Ω ‚Üí —Å–ø–∏—Å–æ–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤¬ª:
   ```json
   {
     "—Å–æ–¥–∞": [
       "–≥–∏–¥—Ä–æ–∫–∞—Ä–±–æ–Ω–∞—Ç –Ω–∞—Ç—Ä–∏—è",
       "–ø–∏—â–µ–≤–∞—è —Å–æ–¥–∞"
     ]
   }
   ```
5. *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)* –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —à–∞–±–ª–æ–Ω –ë–î –¥–ª—è OpenWebUI:
   ```bash
   mkdir -p services/openwebui/data
   cp services/openwebui/webui.db.example services/openwebui/data/webui.db
   ```

    Users:
    - admin@gisp.ru 123
    - gisp@gisp.ru 123

6. *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)* –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –¥–∞–º–ø —á–µ—Ä–µ–∑ `starter-dump`:
   ```bash
   COMPOSE_PROFILES=starter docker compose run -T --rm starter-dump
   ```
   –ó–∞–≥—Ä—É–∑–∏—Ç ~531K –∑–∞–ø–∏—Å–µ–π —Ä–µ–µ—Å—Ç—Ä–∞ + –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (~902MB —Å–∂–∞—Ç–æ; –Ω–∞ –¥–∞—Ç—É: 06.02.2025).

7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å—Ç–µ–∫:
   ```bash
   docker compose up -d --build postgres_registry api import semantic openwebui
   ```

# **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –∏—Ö Dockerfile'—ã –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `services/<name>` (api, import, semantic, openwebui –∏ —Ç.–¥.).
<!-- –°—Ö–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API (Excalidraw): —Å–º. —Ñ–∞–π–ª docs/workflow.excalidraw -->

<picture>
  <source media="(prefers-color-scheme: dark)" srcset="docs/scheme-dark.png">
  <source media="(prefers-color-scheme: light)" srcset="docs/scheme-light.png">
  <img alt="–°—Ö–µ–º–∞ —Å–µ—Ä–≤–∏—Å–æ–≤" src="docs/chat-light.png">
</picture>

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä postgres_registry**
> PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pgvector. –•—Ä–∞–Ω–∏—Ç:
> - `registry.reestr` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Ä–µ–µ—Å—Ç—Ä–∞ (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π –ú–∏–Ω–ø—Ä–æ–º—Ç–æ—Ä–≥–∞);
> - `registry.load_log` ‚Äî –∂—É—Ä–Ω–∞–ª –∑–∞–≥—Ä—É–∑–æ–∫ CSV;
> - `registry.semantic_items` ‚Äî –∫—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (reestr_id + –≤–µ–∫—Ç–æ—Ä);
> - `registry.semantic_query_cache` ‚Äî –∫—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤ —á–∞—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π (–ø–∞—Ä–∞–º–µ—Ä—Ç—Ä `SEMANTIC_CACHE_TTL_SECONDS`).

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä api**
> FastAPI-—à–ª—é–∑ –¥–ª—è REST-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤—ã–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö —Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä import**
> –§–æ–Ω–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç—ë—Ä: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —Å–∫–∞—á–∏–≤–∞–µ—Ç CSV, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ª–∏–≤–∞–µ—Ç –≤ –±–∞–∑—É. –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω cron: –≤ 00:05 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `run_import.sh`, –≤ 05:00 ‚Äî `run_pg_maintenance.sh`
>
> –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤—Ä—É—á–Ω—É—é:
> ```bash
> docker compose run --rm import /scripts/run_import.sh
> ```
> –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ `AUTO_EMBED=1`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ã–∑–æ–≤–µ—Ç embeddings-worker –∏ –æ–±–Ω–æ–≤–∏—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π.
> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω—ã `BOT_TOKEN`/`CHAT_ID`).

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä semantic**
> FastAPI-—à–ª—é–∑ –¥–ª—è REST-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç—Ä–æ–∏—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å —É—á–µ—Ç–æ–º `synonyms.json`. –í –æ–±—Ä–∞–∑ —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `paraphrase-multilingual-MiniLM-L12-v2`.
>
> ### –í—ã–±–æ—Ä backend: ONNX vs PyTorch
>
> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `gisp-semantic-onnx:latest` (ONNX Runtime) ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –æ–±–µ–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä.
>
> **–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—Ä–∞–∑—ã:**
> - `gisp-semantic-onnx:latest` ‚Äî ONNX Runtime (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
> - `gisp-semantic-pytorch:latest` ‚Äî PyTorch (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
>
> **–ë–µ–Ω—á–º–∞—Ä–∫–∏ Python 3.12 + pymorphy3:**
>
> | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | Backend | –†–∞–∑–º–µ—Ä | –°–∫–æ—Ä–æ—Å—Ç—å (—Å—Ä–µ–¥–Ω—è—è) |
> |-------------|---------|--------|-------------------|
> | AMD64 | ONNX | ~1.03 GB | 27-32ms ‚ö° |
> | AMD64 | PyTorch | ~1.93 GB | 28-35ms |
> | ARM64 | ONNX | ~1.69 GB | 37-44ms ‚úÖ |
> | ARM64 | PyTorch | ~2.46 GB | 104-186ms üêå |
>
> **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
> - **AMD64 (Intel/AMD)**: ONNX –Ω–∞ 87% –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –ø—Ä–∏ —Ç–æ–π –∂–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
> - **ARM64 (Apple Silicon)**: ONNX –≤ 3+ —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞ 45% –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ
>
> **–ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ PyTorch:**
> –ò–∑–º–µ–Ω–∏—Ç–µ `image` –≤ `compose.yaml` –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ `semantic` –∏ `embeddings-worker`:
> ```yaml
> semantic:
>   image: docker.io/0x3654/gisp-semantic-pytorch:latest
> embeddings-worker:
>   image: docker.io/0x3654/gisp-semantic-pytorch:latest
> ```
> –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
> ```bash
> docker compose up -d semantic
> ```

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä embeddings-worker**
> –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤. –°—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ –∫–æ–º–∞–Ω–¥–µ `docker compose run --rm embeddings-worker`, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–æ—Ä—Å-–ø–µ—Ä–µ—Å—á—ë—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã openwebui**
> WebUI –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ —á–∞—Ç–∞.

> ## **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä starter-dump**
> –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î —Å—Ç–∞—Ä—Ç–æ–≤—ã–º —Å–Ω–µ–ø—à–æ—Ç–æ–º.
>
> **–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å:**
> - –ü—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ –ø—É—Å—Ç—É—é –ë–î
> - –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–±–æ—è
> - –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–æ —Å–≤–µ–∂–µ–≥–æ —Å–Ω–µ–ø—à–æ—Ç–∞
>
> **–ó–∞–ø—É—Å–∫:**
> ```bash
> COMPOSE_PROFILES=starter docker compose run -T --rm starter-dump
> ```
>
> **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
> - `STARTER_FORCE=0` ‚Äî (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –≤ `registry.reestr` –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
> - `STARTER_FORCE=1` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é!)
> - `STARTER_MAX_WAIT=180` ‚Äî –º–∞–∫—Å. –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è PostgreSQL (—Å–µ–∫—É–Ω–¥—ã)
>
> **–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–Ω–µ–ø—à–æ—Ç:**
> - ‚úÖ `registry.reestr` ‚Äî –∑–∞–ø–∏—Å–∏ —Ä–µ–µ—Å—Ç—Ä–∞ (~531K —Å—Ç—Ä–æ–∫, ~902MB —Å–∂–∞—Ç–æ)
> - ‚úÖ `registry.semantic_items` ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
> - ‚ùå `registry.load_log` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
> - ‚ùå `registry.semantic_query_cache` ‚Äî –∫–µ—à –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∞–º)
>
> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 0.

# I. **FastAPI Web API**
<details>
<summary><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b></summary>
> ### –≠–Ω–¥–ø–æ–∏–Ω—Ç: GET `/reestr`

> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
> | –ü–∞—Ä–∞–º–µ—Ç—Ä      | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
> |---------------|--------|--------------------------------------------------------------------------|
> | `inn`         | `str`  | –ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏|
> | `tnved`       | `str`  | –ö–æ–¥ –¢–ù–í–≠–î|
> | `okpd2`       | `str`  | –ö–æ–¥ –û–ö–ü–î2                                                              |
> | `productname` | `str`  | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `$` –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ `^` –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö |
> | `regnumber`   | `str`  | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç "244\4\2023"                            |
> | `nameoforg`   | `str`  | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.                                                   |
> | `code`        | `str`  | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–¥, –∏—â–µ—Ç –∏ –ø–æ –ò–ù–ù, –∏ –ø–æ –¢–ù–í–≠–î                         |
> | `limit`       | `int`  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20, –º–∞–∫—Å–∏–º—É–º 200 ‚Äî —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è `REESTR_*` –≤ `.env`) |
> | `offset`      | `int`  | –°–º–µ—â–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0, –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ)                             |


 ---

> **–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:**
> - –§–æ—Ä–º–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
> - –ü–∞—Ä–∞–º–µ—Ç—Ä `code` –∏—â–µ—Ç—Å—è –∏ –ø–æ –ò–ù–ù, –∏ –ø–æ –¢–ù–í–≠–î
> - –ü–∞—Ä–∞–º–µ—Ç—Ä `productname` —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –ø–æ `$` (–≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å) –∏ `^` (–ª—é–±–æ–π –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤), –∫–∞–∂–¥–∞—è —á–∞—Å—Ç—å –∏—â–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ILIKE`
> - –ü–∞—Ä–∞–º–µ—Ç—Ä `regnumber` –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è (–æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª—ç—à)
> - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `limit` –∏ `offset`

> **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π JSON:**
> ```json
> {
>   "rows": [...],
>   "limit": 20,
>   "offset": 0,
>   "count": 20
> }
> ```


---

> ### –≠–Ω–¥–ø–æ–∏–Ω—Ç: GET `/reestr/semantic`

> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
> | –ü–∞—Ä–∞–º–µ—Ç—Ä    | –¢–∏–ø   | –û–ø–∏—Å–∞–Ω–∏–µ |
> |-------------|-------|----------|
> | `text`      | `str` (**–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**) | –°–≤–æ–±–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç, —á—Ç–æ –≤–≤–æ–¥–∏—Ç—Å—è –≤ —á–∞—Ç (`semantic|‚Ä¶`) |
> | `limit`     | `int` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (1‚Äì100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) |
> | `offset`    | `int` | –°–º–µ—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (>=0) |
> | `inn` / `tnved` / `okpd2` / `regnumber` / `nameoforg` / `code` | –∫–∞–∫ –≤ `/reestr` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è |


---

> **–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:**
> - API –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç embedding —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `semantic`, –≥–¥–µ –∑–∞–ø—Ä–æ—Å –æ—á–∏—â–∞–µ—Ç—Å—è, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –∏–∑ `services/semantic/synonyms.json`.
> - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–∞–±–ª–∏—Ü–µ `registry.semantic_items` —Å fallback-–ª–∏—Å—Ç–æ–º:
>   - –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `limit*2`, –∑–∞—Ç–µ–º (–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞–ª–æ) –ª–∏–º–∏—Ç —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è –¥–æ 800 —Å—Ç—Ä–æ–∫.
>   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ T–ù–í–≠–î ¬´—É—Å–µ–∫–∞–µ—Ç—Å—è¬ª (10‚Üí8‚Üí6‚Üí4) –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—É—Å—Ç—ã—Ö –≤—ã–±–æ—Ä–æ–∫.
> - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—á—ë—Ç–æ–º –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (`inn`, `okpd2`, ‚Ä¶) –∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ (`embedding <=> query`).
> - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ —Ç–µ–∫—Å—Ç—É –±–µ—Ä—É—Ç embedding –∏–∑ –∫—ç—à–∞ PostgreSQL (`registry.semantic_query_cache`, TTL –∑–∞–¥–∞—ë—Ç—Å—è `SEMANTIC_CACHE_TTL_SECONDS`).

> **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π JSON (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ):**
> ```json
> {
>   "rows": [
>     {
>       "productname": "...",
>       "distance": 0.1372,
>       "token_matches": 5,
>       "...": "..."
>     }
>   ],
>   "limit": 10,
>   "offset": 0,
>   "count": 10,
>   "semantic": {
>     "original_query": "–°–æ–¥–∞ –ø–∏—â–µ–≤–∞—è 500–≥—Ä.*24",
>     "normalized_query": "—Å–æ–¥–∞ –ø–∏—â–µ–≤–∞—è 500–≥—Ä 24",
>     "synonyms": ["–≥–∏–¥—Ä–æ–∫–∞—Ä–±–æ–Ω–∞—Ç –Ω–∞—Ç—Ä–∏—è"],
>     "tokens": ["—Å–æ–¥–∞", "–ø–∏—â–µ–≤–∞—è", "500–≥—Ä", "*24"],
>     "fallback_attempts": [
>       {"label": "original", "rows": 20, "limit_used": 20, "elapsed": 1.2}
>     ],
>     "fallback_used": false,
>     "active_filters": {
>       "inn": null,
>       "tnved": null,
>       "okpd2": null,
>       "regnumber": null,
>       "code": null
>     }
>   }
> }
> ```
</details>

---

# II. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ
<details>
<summary><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b></summary>

> 1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞**
>  - –ú–µ—Ç–æ–¥ [`pipe()`](#pipebody-dict) –±–µ—Ä—ë—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `body["messages"]`
>   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é `role="user"`
>   - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `text`

>2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
>   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –≤–∫–ª—é—á—ë–Ω –ª–∏ `debug` ([`_extract_debug_flag`](#_extract_debug_flagtext)) ‚Äî –¥–ª—è –≤—ã–≤–æ–¥–∞ –æ—Ç–ª–∞–¥–∫–∏
>   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è `max_rows` ([`_extract_max_rows`](#_extract_max_rowstext)) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞
>   - –ò–∑ —Ç–µ–∫—Å—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (`debug`, `max_rows`) —á–µ—Ä–µ–∑ [`clean_control_params`](#clean_control_paramstext)
>   - –£–¥–∞–ª—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ —á–µ—Ä–µ–∑ [`_strip_debug_lines`](#_strip_debug_lines)

>3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —è–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
>   - –ú–µ—Ç–æ–¥ [`_extract_explicit`](#_extract_explicittext) –∏—â–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ:
>     - `INN` (`–∏–Ω–Ω`, `inn`)
>     - `TNVED` (`tnved`, `—Ç–Ω–≤—ç–¥`, `—Ç–Ω–≤–µ–¥`)
>     - `OKPD2` (`okpd2`, `–æ–∫–ø–¥2`)
>     - `REGNUMBER` (`regnumber`, `—Ä–µ–≥–Ω–æ–º–µ—Ä`)
>     - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (`productname`, `—Ç–æ–≤–∞—Ä`, `–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ`)
>   - –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ª–æ–≤–∞—Ä—å `params`

>4. **–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞**
>   - –ò–∑ —Ç–µ–∫—Å—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ `ALL_KEYS` –∏ –∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞ "–∏–Ω–Ω", "tnved", "–æ–∫–ø–¥2" –∏ —Ç.–ø.), —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ `productname`
>   - `OKPD2` —Ç–∞–∫–∂–µ –≤—ã—Ä–µ–∑–∞–µ—Ç—Å—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `productname`

>5. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞**
>   - –ï—Å–ª–∏ —è–≤–Ω–æ–≥–æ `productname` –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –∏ —á–∏—Å–µ–ª –±–µ—Ä—ë—Ç—Å—è –∫–∞–∫ `productname`
>   - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è:
>     - `inn` ‚Äî —á–∏—Å–ª–∞ 10‚Äì12 —Ü–∏—Ñ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
>     - `tnved` ‚Äî —á–∏—Å–ª–∞ 4, 6, 8, 10 —Ü–∏—Ñ—Ä, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–æ—à–ª–∏ –∫–∞–∫ `INN`
>   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –æ–¥–∏–Ω 10-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ ‚Äî –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ `code`, –∏ `inn`/`tnved` –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
>   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω —Ç–æ–ª—å–∫–æ `INN` –∏–ª–∏ —Ç–æ–ª—å–∫–æ `TNVED` ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è `code` —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –∏—Å—Ö–æ–¥–Ω—ã—Ö `inn`/`tnved`
>   - –ò—Ç–æ–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `params`, –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è `max_rows` –∏ —Ñ–ª–∞–≥ `debug`

>6. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API**
>   - –í `params_to_send` –ø–æ–º–µ—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `code`, `inn`, `tnved`, `okpd2`, `productname`, `regnumber`
>   - –°—Ç—Ä–æ–∫–∏ –∏ —Å–ø–∏—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `|` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

>7. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ fallback**
>   - –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º–∏ `params_to_send
>   - –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:
>     1. –ï—Å–ª–∏ –µ—Å—Ç—å `code`, –æ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ `TNVED`, –∏ –ø—Ä–æ–±—É—é—Ç—Å—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è TNVED 10‚Üí8‚Üí6‚Üí4
>     2. –ï—Å–ª–∏ –µ—Å—Ç—å `TNVED`, –ø—Ä–æ–±—É—é—Ç—Å—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è TNVED 8‚Üí6‚Üí4
>   - –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `fallback_debug` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç–ª–∞–¥–∫–µ

>8. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞**
>   - –†–µ–∑—É–ª—å—Ç–∞—Ç API –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ [`_normalize_rows`](#_normalize_rowspayload) (—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
>   - –¢–∞–±–ª–∏—Ü–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ [`_format_table`](#_format_tablerows-meta-max_rows):
>     - –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `FIELD_RENAME`
>     - –î–∞—Ç—ã (`docdate`, `docvalidtill`) –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —Ñ–æ—Ä–º–∞—Ç—É `DD.MM.YYYY`
>   - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç ‚Äî –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:
>     > "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º."
>   - –ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω `debug`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±–ª–æ–∫ —Å:
>     - –ü–µ—Ä–µ—á–Ω–µ–º fallback-–ø–æ–ø—ã—Ç–æ–∫
>     - –ò—Ç–æ–≥–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞
>   - –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

>9. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
>   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ `productname`: `$` ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò, `^` ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò
>   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ò–ù–ù
>   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
>   - –û—á–∏—Å—Ç–∫–∞ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
</details>

# III. Chat Pipe (`reestr_openwebui.py`)

<details>
<summary><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b></summary>

>–ö–ª–∞—Å—Å `Pipe` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è API

### –ú–µ—Ç–æ–¥—ã

#### `_detect_data_type(text: str) -> dict`
>- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `inn`, `tnved`, `okpd2`, `regnumber`, `productname`, `code`
>- –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç `OKPD2` –¥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `productname`
>- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –µ–¥–∏–Ω–∏—á–Ω—ã–π 10-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ ‚Äî –æ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è `code`
>- –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å `params` —Å —Ñ–ª–∞–≥–æ–º `debug` –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `max_rows`

#### `pipe(body: dict)`

>- –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
>- –ü–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
>- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API (`/reestr`)
>- –†–µ–∞–ª–∏–∑—É–µ—Ç fallback: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `code` –≤ `tnved` —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏ (10‚Üí8‚Üí6‚Üí4), –∞ —Ç–∞–∫–∂–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è TNVED (8‚Üí6‚Üí4)
>- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Markdown-—Ç–∞–±–ª–∏—Ü—É —Å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (`FIELD_RENAME`)
>- –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `debug` –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ fallback –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
>- –ö–æ–º–∞–Ω–¥–∞ `semantic|‚Ä¶` (–∏–ª–∏ `—Å–∏–º–∞`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º:
>  - —Ç–µ–∫—Å—Ç –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª, –∑–∞—Ç–µ–º —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–æ–¥–∞ –ø–∏—â–µ–≤–∞—è¬ª ‚Üí ¬´–≥–∏–¥—Ä–æ–∫–∞—Ä–±–æ–Ω–∞—Ç –Ω–∞—Ç—Ä–∏—è¬ª) –∏–∑ `services/semantic/synonyms.json`;
>  - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–Ω–∂–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–≤–ø–∞–≤—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏;
>  - —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ —Ç–æ–∫–µ–Ω–∞–º –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –≤—ã–¥–∞—á–∏.
>  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª—ë–≥–∫–∞—è –ª–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –Ω–∞ CPU ‚Äî –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –±—ã—Å—Ç—Ä–æ, –±–µ–∑ —É—á–∞—Å—Ç–∏—è LLM –∏ –±–µ–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ GPU.

</details>

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —á–∞—Ç–µ

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Pipe —Å–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∏—Ç —Ñ–∏–ª—å—Ç—Ä—ã –∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `/reestr`; —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Å—Ç–∞—ë—Ç—Å—è ¬´–ª–∏—à–Ω–∏–π¬ª —Ç–µ–∫—Å—Ç –∏–ª–∏ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –Ω–∞–±—Ä–∞–ª `semantic|`.

**–ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å —Å—Ç—Ä–æ–≥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º:**
- –∑–∞–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —è–≤–Ω–æ–º –≤–∏–¥–µ (–∫–∞–∂–¥–∞—è –ø–∞—Ä–∞ "–ø–∞—Ä–∞–º–µ—Ç—Ä: –∑–Ω–∞—á–µ–Ω–∏–µ" –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª):
  - `inn:` / `–∏–Ω–Ω:`
  - `tnved:` / `—Ç–Ω–≤–µ–¥:` / `—Ç–Ω–≤—ç–¥:` / `—Ç–Ω –≤—ç–¥:`
  - `okpd2:` / `–æ–∫–ø–¥2:`
  - `regnumber:` / `—Ä–µ–≥–Ω–æ–º–µ—Ä:` / `—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä:`
  - `productname:` / `product:` / `name:` / `—Ç–æ–≤–∞—Ä:` / `–ø—Ä–æ–¥—É–∫—Ç:` / `–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:` / `–∞—Ä—Ç–∏–∫—É–ª:`
  - `nameoforg:` / `–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:` / `organization:`
  - `code:` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è INN –∏–ª–∏ TNVED)
  - `semantic|` (–¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞);
  - `—Å—Ä–∞–≤–Ω–∏` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è; —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö:
    - –¥–≤–µ —Å—Ç—Ä–æ–∫–∏: `—Å—Ä–∞–≤–Ω–∏\n—Å—Ç—Ä–æ–∫–∞1\n—Å—Ç—Ä–æ–∫–∞2` ‚Äî –≤–µ—Ä–Ω—ë—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –æ–±–µ–∏—Ö —Å—Ç—Ä–æ–∫;
    - –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ + —Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã —Å—á–∏—Ç–∞–µ—Ç—Å—è ¬´–∏—Å—Ö–æ–¥–Ω–æ–π¬ª, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –∫–∞–Ω–¥–∏–¥–∞—Ç—ã; Pipe –ø–æ–¥–±–µ—Ä—ë—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞, –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ —Å—Ö–æ–¥—Å—Ç–≤—É –∏ –≤—ã–≤–µ–¥–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏—è–º–∏ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ø‚Äë10, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `max: 20` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ 1000), —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ –≤—Å—é —Ç–∞–±–ª–∏—Ü—É. –§–ª–∞–≥–∏ `--debug`/`--nodebug` —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.
  –ø—Ä–∏–º–µ—Ä: `inn:6617025849 tnved:340220 productname:"—Å–æ–¥–∞ –∫–∞–ª—å—Ü–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è"`;
- –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç `regnumber:1257\16\2023` / `code:6617025849` ‚Äî –Ω–∞–ª–∏—á–∏–µ `regnumber` –≤—Å–µ–≥–¥–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫;

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–ª–æ–≤–∞:**
  - `debug:on` / `debug` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –∫—Ä–∞—Ç–∫–∏–π –±–ª–æ–∫ ¬´–û—Ç–ª–∞–¥–∫–∞ (–∫—Ä–∞—Ç–∫–æ)¬ª —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ fallback‚Äô–∞–º–∏;
  - `debug:full` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç JSON-–æ—Ç–≤–µ—Ç API/—Å–µ–º–∞–Ω—Ç–∏–∫–∏ —Ü–µ–ª–∏–∫–æ–º;
  - `debug:summary` / `debug short` ‚Äî –≤—ã–≤–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ –±–µ–∑ JSON;
  - `debug:off` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é;
  - `max:20` / `rows:50` ‚Äî –∑–∞–¥–∞—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ (–∞–Ω–∞–ª–æ–≥ `limit`);
  - `semantic|` (`—Å–µ–º–∞–Ω—Ç–∏–∫|`, `—Å–∏–º–∞|`) ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫.
  - `—Å—Ä–∞–≤–Ω–∏` ‚Äî —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏: –ª–∏–±–æ –æ–¥–Ω–∞ –ø–∞—Ä–∞, –ª–∏–±–æ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ + —Å–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –ú–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –ø—Ä–∏–∑–Ω–∞–∫/–Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–∏–∂–µ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É.



##### **–°–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤**
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ `services/semantic/synonyms.json` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä—ã –≤–∏–¥–∞ `"–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ": ["–≤–∞—Ä–∏–∞–Ω—Ç1", "–≤–∞—Ä–∏–∞–Ω—Ç2"]`.
- –•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è.
- –ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ `semantic` (`docker compose build semantic && docker compose up -d semantic`), —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à –º–æ–¥–µ–ª–∏.
- OpenWebUI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –Ω–æ–≤—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–æ–¥–∞¬ª ‚Üí ¬´–≥–∏–¥—Ä–æ–∫–∞—Ä–±–æ–Ω–∞—Ç –Ω–∞—Ç—Ä–∏—è¬ª) –ø–æ–π–¥—É—Ç –≤ —Ä–∞–±–æ—Ç—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

#### `_format_table(rows, meta, max_rows)`

> - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
> - –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `FIELD_RENAME`
> - –î–∞—Ç—ã (`docdate` –∏ `docvalidtill`) —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –≤ `DD.MM.YYYY`

#### `_normalize_rows(payload)`

> - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—Ç–≤–µ—Ç API –≤ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

#### `_extract_explicit(text)`

> - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —è–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞:
>   - `INN` (`–∏–Ω–Ω`, `inn`)
>   - `TNVED` (`tnved`, `—Ç–Ω–≤—ç–¥`, `—Ç–Ω–≤–µ–¥`)
>   - `OKPD2` (`okpd2`, `–æ–∫–ø–¥2`)
>   - `REGNUMBER` (`regnumber`, `—Ä–µ–≥–Ω–æ–º–µ—Ä`)
>   - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (`productname`, `—Ç–æ–≤–∞—Ä`, `–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ`)
>   - `Nameoforg` (`nameoforg`, `–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è`, `organization` –∏ –¥—Ä.)
> - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ `(params, –æ—á–∏—â–µ–Ω–Ω—ã–π_—Ç–µ–∫—Å—Ç)`:
>   - `params` ‚Äî —Å–ª–æ–≤–∞—Ä—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
>   - `–æ—á–∏—â–µ–Ω–Ω—ã–π_—Ç–µ–∫—Å—Ç` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —è–≤–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

#### `_extract_debug_flag(text)`

> - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤–∫–ª—é—á—ë–Ω –ª–∏ —Ä–µ–∂–∏–º `debug`

#### `_extract_max_rows(text)`

> - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `max_rows`

#### `clean_control_params(text)`

>- –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `debug` –∏ `max_rows` –∏–∑ —Ç–µ–∫—Å—Ç–∞

#### `split_terms(value)`

> - –•–µ–ª–ø–µ—Ä –∏–∑ API: –¥–µ–ª–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `productname` –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º `$` (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò) –∏ `^` (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò), —É–¥–∞–ª—è—è –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

#### `_validate_inn(inn_str)`

> - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)

---
